<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="/static/main.css" rel="stylesheet">
    <link href="/static/animations.css" rel="stylesheet">
    <title>Timeline</title>
</head>

<body>
    <div class="max-w-screen min-h-screen flex" id="vue-app">
        <div class="min-h-screen w-full flex flex-col">
            <!-- Player ticker -->
            <div class="w-full py-3 border-b-2 border-gray-200">
                <div class="flex justify-center space-x-6">
                    <div v-for="player in players">
                        <div class="text-gray-300 flex flex-col items-center" v-bind:class="{
              'text-gray-400': player.username === currentTurn,
            }">
                            <span>{{player.username}} ({{player.cardsRemaining}})</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- The area that shows the timeline -->
            <div id="timeline" class="w-full flex-grow flex items-center overflow-x-scroll">
                <div v-for="(card, index) in timeline" class="flex py-10" @drop="cardDropped"
                    @dragover="cardDraggedOver" @dragleave="cardDragLeft">
                    <div>
                        <div class="relative h-56 w-40 transform transition duration-200" v-bind:class="{
              'translate-x-44': dropPlaceholderIndex !== null && dropPlaceholderIndex <= index,
              'ml-32': index === 0,
              'ml-2': index !== 0,
              'mr-2': index !== (timeline.length - 1),
              'mr-32': index === (timeline.length - 1),
              'transition-none': !timelineTransitionsEnabled,
              'opacity-0': index === removedIndex,
              'translate-y-[-150pt]': index === removedIndex,
            }">
                            <div class="absolute w-full h-full flex items-center border-2 rounded-md border-gray-300 transform transition-transform flippable"
                                v-bind:class="{
                'flipped': flippedIndices.includes(index),
              }">
                                <span class="w-full p-4 text-center text-gray-400 text-3xl">{{card.frontValue}}<span
                                        v-if="showAll" class="text-blue-400"><br>{{card.backValue}}</span></span>
                            </div>
                            <div class="absolute w-full h-full flex items-center text-gray-400 border-2 rounded-md border-gray-300 transform transition-transform flippable"
                                v-bind:class="{ 
                  'flipped': !flippedIndices.includes(index),
                  'border-red-300': index === justDroppedInfo?.index && justDroppedInfo?.isCorrect === false,
                  'bg-red-100': index === justDroppedInfo?.index && justDroppedInfo?.isCorrect === false,
                  'text-red-600': index === justDroppedInfo?.index && justDroppedInfo?.isCorrect === false,
                  'border-green-300': index === justDroppedInfo?.index && justDroppedInfo?.isCorrect === true,
                  'bg-green-100': index === justDroppedInfo?.index && justDroppedInfo?.isCorrect === true,
                  'text-green-600': index === justDroppedInfo?.index && justDroppedInfo?.isCorrect === true,
                }">
                                <span class="w-full p-4 text-center text-3xl">{{card.backValue}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="w-full py-4 bg-gray-50 flex flex-col items-center">
                <!-- Current turn indicator -->
                <div v-if="isMyTurn && !ended" class="inline-block mx-auto bg">
                    <div class="text-blue-500 text-lg font-medium justify-center flex items-center space-x-1">
                        <span class="">It's your turn</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd"
                                d="M16.707 10.293a1 1 0 010 1.414l-6 6a1 1 0 01-1.414 0l-6-6a1 1 0 111.414-1.414L9 14.586V3a1 1 0 012 0v11.586l4.293-4.293a1 1 0 011.414 0z"
                                clip-rule="evenodd" />
                        </svg>
                    </div>
                    <div class="text-gray-400 text-sm">Drag one of your cards into the Timeline, placing it in order.
                    </div>
                </div>

                <!-- The player's hand -->
                <div class="mt-8 flex flex-row space-x-4">
                    <div v-for="(card, index) in hand">
                        <div :draggable="isMyTurn" @dragstart="cardDragStarted($event, index)"
                            class="h-56 w-40 flex items-center border-2 rounded-md border-gray-300 transition duration-300"
                            v-bind:class="{
                'translate-y-[150pt]': undealtHandIndices.includes(index),
                'opacity-0': undealtHandIndices.includes(index),
                'translate-x-[5.5rem]': isDealingInNewCard && !undealtHandIndices.includes(index),
                'transition-none': !handTransitionsEnabled
              }">
                            <span class="w-full p-4 text-center text-gray-400 text-3xl">{{card.frontValue}}<span
                                    v-if="showAll" class="text-blue-400"><br>{{card.backValue}}</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Sidebar for gameover screen -->
        <transition class="transform duration-300">
            <div v-if="ended" class="min-h-screen fixed right-0 bg-white flex-1 p-10 py-5 text-gray-400 border-l-2 border-gray-200">
                <div class="whitespace-nowrap space-y-10">
                    <h1 class="font-bold px-7 text-center text-4xl">
                        <span class="text-blue-500">game over!</span>
                    </h1>
                    <div>
                        <p class="text-center text-lg">
                            <span class="font-extrabold text-blue-400">Winner : <span class="font-semibold text-gray-400">
                                    {{stats.winner}} </span></span>
                        </p>
                        <div v-for="player in players" class="text-center text-lg font-semibold text-gray-400">
                            <br><span v-if="player.cardsRemaining > 0"> {{player.username}} ({{player.cardsRemaining}})
                            </span>
                        </div>
                    </div>
                    <p class="text-sm italic">
                        <span class="font-bold text-blue-400">correctly <span class="font-semibold text-gray-400">placed
                                cards <span class="font-semibold text-blue-400">: </span><span
                                    class="text-lg font-bold text-blue-400">{{stats.correctlyPlaced}}</span></span></span>
                        <br><span class="font-bold text-blue-400">incorrectly <span
                                class="font-semibold text-gray-400">placed cards <span
                                    class="font-semibold text-blue-400">: </span><span
                                    class="text-lg font-bold text-blue-400">{{stats.incorrectlyPlaced}}</span></span></span>
                        <br><span class="font-bold text-gray-400">timeline <span
                                class="font-semibold text-blue-400">length : <span
                                    class="text-lg font-bold text-blue-400">{{stats.timelineLength}}</span></span></span>
                    </p>
                    <div>
                        <button @click="restart()"
                            class="block w-full p-3 rounded bg-blue-400 hover:bg-blue-300 transition duration-100 hover:text-blue-800">Play-again</button>
                        <a href="/">
                            <button class="block p-3 w-full transition duration-100 text-blue-600 hover:text-blue-800 font-bold text-sm">exit lobby</button>
                        </a>
                    </div>
                </div>
            </div>
        </transition>
    </div>

</body>

</html>